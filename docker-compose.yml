services:
  latex:
    build: docker/latex
    volumes:
      - tmpCompil:/tmp/ccsdtex
    deploy:
      resources:
        limits:
          memory: 512m

  convert:
    container_name: convert-php
    build: docker/php
    #ports:
    #  - "9000:9000" # Port Xdebug
    volumes:
      - .:/srv/app/convert
      - ./docker/php/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./docker/php/fastcgi_params_symfony:/etc/nginx/fastcgi_params_symfony
      - ./docker/php/convert.conf:/etc/nginx/conf.d/convert.conf:ro
      - ./docker/php/certs:/etc/nginx/certs:ro
      # Partage de la zone de compilation, les fichiers tex seront posé la
      - tmpCompil:/latexRoot/tmp/ccsdtex
      # Partage des documents sources, pour copier les résultats dans le dossier docs
      - ./docker/fixtures/docs:/docs
      # partage du socket docker pour pouvoir utiliser docker dans le container
      - /var/run/docker.sock:/var/run/docker.sock
      
    working_dir: /srv/app/convert
    extra_hosts:
      - "host.docker.internal:host-gateway"
    deploy:
      resources:
        limits:
          memory: 256m

volumes:
  tmpCompil: ~
